<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AJAX Demo</title>
</head>

<body>

<input id="text" type="text" placeholder="è¾“å…¥ç‚¹ä¸œè¥¿" />
<button onclick="showAdress()">è·å–ç”¨æˆ·ä¿¡æ¯</button>


<div class="card">
    <h3>ğŸ“‹ å®¢æˆ·åˆ—è¡¨</h3>

    <div class="table-responsive">
        <table id="customerTable">
            <thead>
            <tr>
                <th>ID</th>
                <th>å§“å</th>
                <th>ç”µè¯</th>
                <th>é‚®ç®±</th>
                <th>è¡Œä¸š</th>
                <th>åœ°å€</th>
                <th>å½’å±äºº ID</th>
                <th>åˆ›å»ºæ—¶é—´</th>
                <th>æ›´æ–°æ—¶é—´</th>
                <th>æ“ä½œ</th>
            </tr>
            </thead>

            <tbody id="customerBody">
            <tr><td colspan="10">åŠ è½½ä¸­...</td></tr>
            </tbody>
        </table>
    </div>
</div>
</body>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>

<script>
    function showAdress() {
        const input = document.getElementById("text").value.trim();

        // æ˜¾ç¤º loading çŠ¶æ€
        const body = document.getElementById("customerBody");
        body.innerHTML = `<tr><td colspan="10">åŠ è½½ä¸­...</td></tr>`;

        $.ajax({
            url: "http://localhost:8080/api/customers/user",
            type: "get",
            dataType: "json",
            // å¦‚æœä½ æƒ³æŠŠè¾“å…¥ä½œä¸ºæŸ¥è¯¢å‚æ•°å‘ç»™åç«¯ï¼Œå¯ä»¥å¯ç”¨ä¸‹é¢ä¸€è¡Œï¼š
            // data: { q: input },

            success: function (res) {
                // å®‰å…¨è·å–æ•°ç»„ï¼šå…¼å®¹åç«¯ç›´æ¥è¿”å›æ•°ç»„ æˆ–è€… { data: [...] } ä¸¤ç§æƒ…å†µï¼Œ

                let list = [];
                if (Array.isArray(res)) {
                    list = res;
                    console.log("this is  1"+ Array.isArray(list))
                    console.log("this is  11", list)

                } else if (Array.isArray(res.data)) {
                    list = res.data;

                    console.log("this is 2 "+ list);
                } else if (res && typeof res === 'object' && Object.keys(res).length === 0) {
                    list = [];
                } else if (res && res.data && !Array.isArray(res.data)) {
                    // åç«¯è¿”å›å•æ¡å¯¹è±¡ï¼ŒåŒ…æˆæ•°ç»„å¤„ç†
                    list = [res.data];

                    console.log("this is 3 "+ list);
                }



                if (!Array.isArray(list) || list.length === 0) {
                    body.innerHTML = `<tr><td colspan="10">æš‚æ— æ•°æ®</td></tr>`;
                    return;
                }

                body.innerHTML = list.map(u => `
                <tr>
                    <td>${u.id ?? ''}</td>
                    <td>${u.name ?? ''}</td>
                    <td>${u.phone ?? ''}</td>
                    <td>${u.email ?? ''}</td>
                    <td>${u.industry ?? ''}</td>
                    <td>${u.address ?? ''}</td>
                    <td>${u.ownerId ?? ''}</td>
                    <td>${u.createTime ?? ''}</td>
                    <td>${u.updateTime ?? ''}</td>
                    <td>
                        <button onclick="editUser(${u.id})">ç¼–è¾‘</button>
                        <button onclick="deleteUser(${u.id})">åˆ é™¤</button>
                    </td>
                </tr>
            `).join("");
            },

            error: function (xhr, status, err) {
                console.error("AJAX é”™è¯¯ï¼š", status, err, xhr);
                body.innerHTML = `<tr><td colspan="10" style="color:red;">è¯·æ±‚å¤±è´¥ï¼ˆ${status}ï¼‰</td></tr>`;
                alert("è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨æˆ–æŸ¥çœ‹æ§åˆ¶å°/network");
            }
        });
    }

    // å ä½å‡½æ•°ï¼Œé¿å…æŒ‰é’®ç‚¹å‡»æŠ¥é”™ï¼›ä½ å¯ä»¥æ”¹æˆçœŸå®é€»è¾‘
    function editUser(id) {
        alert("ç¼–è¾‘ç”¨æˆ·ï¼š" + id);
    }
    function deleteUser(id) {
        if (!confirm("ç¡®è®¤åˆ é™¤ç”¨æˆ·IDï¼š" + id + "ï¼Ÿ")) return;
        // è¿™é‡Œå®ç°çœŸå®åˆ é™¤é€»è¾‘ï¼ˆè°ƒç”¨åç«¯ DELETEï¼‰ï¼Œç„¶ååˆ·æ–°è¡¨æ ¼
        alert("å·²è¯·æ±‚åˆ é™¤ï¼š" + id);
    }
</script>



</html>
