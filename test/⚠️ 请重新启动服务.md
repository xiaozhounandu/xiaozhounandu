# âš ï¸ ä¿®å¤äº†Jacksonåºåˆ—åŒ–é—®é¢˜

## é—®é¢˜åŸå› 
æ‚¨åœ¨IDEä¸­çœ‹åˆ°çš„é”™è¯¯æ˜¯å› ä¸ºï¼š
```
com.fasterxml.jackson.databind.exc.InvalidDefinitionException:
Java 8 date/time type `java.time.LocalDateTime` not supported by default
```

**é—®é¢˜ä½ç½®**: `AuthInterceptor.java:42`

**æ ¹æœ¬åŸå› **:
- AuthInterceptorä½¿ç”¨äº†æ–°çš„ `ObjectMapper()` å®ä¾‹
- æ²¡æœ‰é…ç½® `JavaTimeModule`
- æ— æ³•åºåˆ—åŒ– `LocalDateTime` ç±»å‹

---

## å·²ä¿®å¤çš„å†…å®¹

### 1. ä¿®å¤AuthInterceptor.java
```java
// ä¿®å¤å‰ï¼ˆç¬¬15è¡Œï¼‰
private final ObjectMapper objectMapper = new ObjectMapper();  // âŒ æ— é…ç½®

// ä¿®å¤å
@Autowired
private ObjectMapper objectMapper;  // âœ… ä½¿ç”¨Springç®¡ç†çš„Bean
```

### 2. åœ¨XiaozhounanduApplication.javaæ·»åŠ é…ç½®
```java
@Bean
public ObjectMapper objectMapper(Jackson2ObjectMapperBuilder builder) {
    return builder.modules(new JavaTimeModule()).build();
    // âœ… æ”¯æŒLocalDateTimeåºåˆ—åŒ–
}
```

### 3. åœ¨application.ymlæ·»åŠ Jacksoné…ç½®
```yaml
spring:
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
    serialization:
      write-dates-as-timestamps: false
```

### 4. åˆ›å»ºGlobalJacksonConfig.java
```java
@Configuration
public class GlobalJacksonConfig {
    @Bean
    public ObjectMapper objectMapper() {
        return Jackson2ObjectMapperBuilder.json()
            .modules(new JavaTimeModule())
            .build();
    }
}
```

---

## ğŸ”„ ç«‹å³æ‰§è¡Œ

### æ­¥éª¤1: åœæ­¢å½“å‰æœåŠ¡
åœ¨IDEä¸­ç‚¹å‡» **Stop** æŒ‰é’®ï¼ˆçº¢è‰²æ–¹å—ï¼‰

### æ­¥éª¤2: æ¸…ç†ç¼–è¯‘ç¼“å­˜
```bash
cd /Users/weizhijie/Desktop/xiaozhounandu-main
rm -rf target/classes/
```

### æ­¥éª¤3: é‡æ–°å¯åŠ¨æœåŠ¡
åœ¨IDEä¸­ï¼š
- æ‰“å¼€ `XiaozhounanduApplication.java`
- å³é”® â†’ **Run As** â†’ **Java Application**

### æ­¥éª¤4: ç­‰å¾…å¯åŠ¨æˆåŠŸ
è§‚å¯Ÿæ§åˆ¶å°ï¼Œåº”è¯¥æ˜¾ç¤ºï¼š
```
âœ… Started XiaozhounanduApplication in XX.X seconds
âœ… No errors
```

### æ­¥éª¤5: æµ‹è¯•ä¿®å¤
```bash
cd test
./å¿«é€Ÿä¿®å¤éªŒè¯.sh
```

---

## ğŸ“‹ å·²ä¿®å¤çš„å®Œæ•´æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶ï¼ˆ2ä¸ªï¼‰
```
âœ“ src/main/java/com/xiaozhounandu/config/GlobalJacksonConfig.java
âœ“ test/âš ï¸ ä¿®å¤åæ“ä½œè¯´æ˜.md
```

### ä¿®æ”¹æ–‡ä»¶ï¼ˆ3ä¸ªï¼‰
```
âœ“ src/main/java/com/xiaozhounandu/interceptor/AuthInterceptor.java
âœ“ src/main/java/com/xiaozhounandu/XiaozhounanduApplication.java
âœ“ src/main/resources/application.yml
```

---

## ğŸ¯ ä¿®å¤éªŒè¯

æˆåŠŸå¯åŠ¨åï¼Œæ‚¨å°†çœ‹åˆ°ï¼š

```
âœ… HikariPool-1 - Start completed  (æ— åºåˆ—åŒ–é”™è¯¯)
âœ… æœåŠ¡æ­£å¸¸ç›‘å¬ 8080ç«¯å£
âœ… å¯ä»¥è®¿é—® /api/init/status
```

æµ‹è¯•å‘½ä»¤ï¼š
```bash
curl http://localhost:8080/api/init/status
```

é¢„æœŸå“åº”ï¼š
```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "status": "æœåŠ¡æ­£å¸¸è¿è¡Œ",
    "timestamp": "2025-12-18 13:50:00"
  }
}
```

---

## ğŸ” å¦‚æœè¿˜æœ‰é”™è¯¯

å¦‚æœé‡å¯åä»ç„¶å‡ºç°Jacksoné”™è¯¯ï¼š

1. **æ£€æŸ¥å¯¼å…¥**ï¼šç¡®è®¤ `pom.xml` ä¸­æœ‰ä»¥ä¸‹ä¾èµ–ï¼ˆå¦‚æœç”¨çš„æ˜¯Spring Boot Starter Webï¼Œä¼šè‡ªåŠ¨åŒ…å«ï¼‰

2. **æ‰‹åŠ¨éªŒè¯**ï¼š
```bash
# æ£€æŸ¥ç¼–è¯‘ç»“æœ
javap -c target/classes/com/xiaozhounandu/interceptor/AuthInterceptor.class | grep ObjectMapper

# åº”è¯¥çœ‹åˆ°: ä¾èµ–æ³¨å…¥çš„ObjectMapper
```

3. **æŸ¥çœ‹å®Œæ•´æ—¥å¿—**ï¼š
```
tail -f test/data/reports/server.log
```

---

## ğŸš€ æˆåŠŸæ ‡å¿—

å½“æ‚¨çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯æ—¶ï¼Œè¡¨ç¤ºJacksoné…ç½®å·²ç”Ÿæ•ˆï¼š

```
2025-12-18 13:48:00.000  INFO --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080
2025-12-18 13:48:00.000  INFO --- [main] c.x.XiaozhounanduApplication  : Started XiaozhounanduApplication
```

**æ²¡æœ‰**ï¼š
- âŒ InvalidDefinitionException
- âŒ LocalDateTimeé”™è¯¯
- âŒ ObjectMapperåºåˆ—åŒ–å¤±è´¥

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… **é‡å¯æœåŠ¡**
2. âœ… **è®¿é—® http://localhost:8080**
3. âœ… **è¿è¡ŒéªŒè¯è„šæœ¬**
4. âœ… **æµ‹è¯•æ‰€æœ‰ä¿®å¤çš„åŠŸèƒ½**

æ‰€æœ‰ä¿®å¤å·²å®Œæˆï¼Œç°åœ¨åªéœ€é‡å¯æœåŠ¡å³å¯ï¼ğŸ‰
